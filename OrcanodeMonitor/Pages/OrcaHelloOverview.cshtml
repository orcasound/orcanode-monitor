@page
@model OrcaHelloOverviewModel
@{
    ViewData["Title"] = "OrcaHello Overview";
}

<div class="text-center">
    <h1 class="display-4"><a href="@Model.AksUrl" target="_blank">OrcaHello</a> Overview</h1>
    As of: @Model.NowLocal (Pacific)<br />
    <h2>Nodes</h2>
    <table>
        <tr>
            <th>Name</th>
            <th>CPU</th>
            <th>Memory</th>
            <th>AVX-512</th>
            <th>Locations</th>
        </tr>
        @foreach (Models.OrcaHelloNode item in Model.Nodes)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.Name)
                </td>
                <td>
                    @(Math.Round(item.CpuPercent))%
                </td>
                <td>
                    @Model.GetNodeMemoryUsage(item) (@(Math.Round(item.MemoryPercent))%)
                </td>
                <td>
                    @(item.HasAvx512 ? "Yes" : "No")
                </td>
                <td>
                    @Model.GetLocations(item)
                </td>
            </tr>
        }
    </table>

    <h2>Pods</h2>
    <table>
        <tr>
            <th>Location</th>
            <th>Detections</th>
            <th>Lag</th>
            <th>CPU</th>
            <th>Memory</th>
            <th>Image</th>
            <th>Node</th>
            <th>Uptime</th>
            <th>Restarts</th>
        </tr>
        @foreach (Models.OrcaHelloContainer item in Model.Containers)
        {
            <tr>
                <td>
                    <a asp-page="/OrcaHelloNode" asp-route-podNamespace="@item.NamespaceName">
                        @Html.DisplayFor(modelItem => item.NamespaceName)
                    </a>
                </td>
                <td>
                    @item.DetectionCount
                </td>
                <td>
                    @Model.GetLag(item)
                </td>
                <td>
                    @(Math.Round(item.CpuPercent))%
                </td>
                <td>
                    @item.MemoryUsage (@(Math.Round(item.MemoryPercent))%)
                </td>
                <td>
                    @item.ImageName
                </td>
                <td>
                    @item.NodeName
                </td>
                @if (Model.GetContainerStatus(item) == Models.OrcanodeOnlineStatus.Absent)
                {
                    <td style="background-color: @Model.GetContainerUptimeBackgroundColor(item); color: @Model.GetContainerUptimeTextColor(item)">
                        @nameof(Models.OrcanodeOnlineStatus.Absent)
                    </td>
                }
                else
                {
                    <td style="background-color: @Model.GetContainerUptimeBackgroundColor(item)">
                        @Model.GetContainerUptime(item)
                    </td>
                }
                <td style="background-color: @Model.GetContainerRestartsBackgroundColor(item)">
                    @item.RestartCount @Model.ContainerLastTerminationReason(item)
                </td>
            </tr>
        }
    </table>
</div>
